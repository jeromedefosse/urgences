<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Formulaire ATU - Traumatologie</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js">document.addEventListener("DOMContentLoaded", function () {
  const fieldsets = document.querySelectorAll("fieldset");
  fieldsets.forEach(fieldset => {
    const checkboxes = fieldset.querySelectorAll("input[type='checkbox']");
    const alertDiv = fieldset.querySelector(".alert");
    if (!alertDiv || checkboxes.length === 0) return;
    function updateAlert() {
      const total = checkboxes.length;
      const checked = fieldset.querySelectorAll("input[type='checkbox']:checked").length;
      if (checked === total) {
        alertDiv.textContent = "‚úÖ √âtape conforme";
        alertDiv.style.backgroundColor = "#d4edda";
        alertDiv.style.color = "#155724";
        alertDiv.style.border = "1px solid #c3e6cb";
      } else if (checked === 0) {
        alertDiv.textContent = "‚õî Aucune case coch√©e";
        alertDiv.style.backgroundColor = "#f8d7da";
        alertDiv.style.color = "#721c24";
        alertDiv.style.border = "1px solid #f5c6cb";
      } else {
        alertDiv.textContent = "‚ö†Ô∏è √âtape partiellement remplie";
        alertDiv.style.backgroundColor = "#fff3cd";
        alertDiv.style.color = "#856404";
        alertDiv.style.border = "1px solid #ffeeba";
      }
    }
    checkboxes.forEach(cb => cb.addEventListener("change", updateAlert));
    updateAlert();
  });
});
</script>
</head>
<body>
  <!-- En-t√™tes √©tablissement / service / patient -->
  <h2>Polyclinique C√¥te Basque Sud</h2>
  <h3>Service : Urgences</h3>
  <label>Nom du patient : <input type="text" name="nomPatient"></label><br>
<label>Pr√©nom du patient : <input type="text" name="prenomPatient"></label><br>
<label>Date de naissance : <input type="date" name="dateNaissance"></label><br>
<label>Sexe : 
  <input type="radio" name="sexe" value="Homme"> Homme
  <input type="radio" name="sexe" value="Femme"> Femme
</label><br>
  <label>Date : <input type="date" name="date" id="autoDate"></label><br>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const autoDateField = document.getElementById("autoDate");
    if (autoDateField && !autoDateField.value) {
      const today = new Date();
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth() + 1).padStart(2, '0');
      const dd = String(today.getDate()).padStart(2, '0');
      autoDateField.value = `${yyyy}-${mm}-${dd}`;
    }
  });
</script>
  <label>Num√©ro de dossier : <input type="text" name="numDossier"></label><br>

  <fieldset>
    <legend>√âl√©ments administratifs √† l'admission</legend>
    <ul>
      <li><input type="checkbox"> Identit√© v√©rifi√©e et conforme (Identitovigilance)</li>
      <li><input type="checkbox"> Recueil de donn√©es administratives complet</li>
      <li><input type="checkbox"> Contexte et motif d‚Äôadmission renseign√©s</li>
      <li><input type="checkbox"> Ant√©c√©dents m√©dicaux identifi√©s</li>
      <li><input type="checkbox"> Ordonnances en cours disponibles</li>
      <li><input type="checkbox"> Personne de confiance identifi√©e</li>
      <li><input type="checkbox"> Directives anticip√©es connues le cas √©ch√©ant</li>
      <li><input type="checkbox"> Pi√®ces justificatives administratives pr√©sentes dans le DPI</li>
    </ul>
    <textarea name="adminComment" placeholder="Commentaires ou anomalies administratives..." style="width:100%; height:60px;"></textarea>
    <div class="alert" style="margin-top:10px; padding:5px; border-radius:5px; font-weight:bold;"></div>
    <div class="alert" style="margin-top:10px; padding:5px; border-radius:5px; font-weight:bold;"></div>
</fieldset>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const fieldsets = document.querySelectorAll("fieldset");
    fieldsets.forEach(fieldset => {
      const checkboxes = fieldset.querySelectorAll("input[type='checkbox']");
      const alertDiv = fieldset.querySelector(".alert");
      if (!alertDiv || checkboxes.length === 0) return;
      function updateAlert() {
        const total = checkboxes.length;
        const checked = fieldset.querySelectorAll("input[type='checkbox']:checked").length;
        if (checked === total) {
          alertDiv.textContent = "‚úÖ √âtape conforme";
          alertDiv.style.backgroundColor = "#d4edda";
          alertDiv.style.color = "#155724";
          alertDiv.style.border = "1px solid #c3e6cb";
        } else if (checked === 0) {
          alertDiv.textContent = "‚õî Aucune case coch√©e";
          alertDiv.style.backgroundColor = "#f8d7da";
          alertDiv.style.color = "#721c24";
          alertDiv.style.border = "1px solid #f5c6cb";
        } else {
          alertDiv.textContent = "‚ö†Ô∏è √âtape partiellement remplie";
          alertDiv.style.backgroundColor = "#fff3cd";
          alertDiv.style.color = "#856404";
          alertDiv.style.border = "1px solid #ffeeba";
        }
      }
      checkboxes.forEach(cb => cb.addEventListener("change", updateAlert));
      updateAlert();
    });
  });
</script>

  <fieldset>
    <legend>√âvaluation et triage IOA ou IDE</legend>
    <ul>
      <li><input type="checkbox"> V√©rification des informations d'identitovigilance</li>
      <li><input type="checkbox"> Int√©gration au dossier des ordonnances en cours</li>
      <li><input type="checkbox"> Int√©gration au dossier des ant√©c√©dents m√©dicaux</li>
      <li><input type="checkbox"> Motif d‚Äôadmission document√©</li>
      <li><input type="checkbox"> Contexte clinique pr√©cis√©</li>
      <li><input type="checkbox"> Sympt√¥mes rapport√©s trac√©s</li>
      <li><input type="checkbox"> √âvaluation clinique initiale r√©alis√©e</li>
      <li><input type="checkbox"> Score FRENCH ou triage formel document√©</li>
      <li><input type="checkbox"> Priorisation valid√©e par l'IDE ou l'IOA</li>
      <li><input type="checkbox"> Contexte et motif d'admission r√©√©valu√©s</li>
      <li><input type="checkbox"> Risques identifi√©s et trac√©s (douleur, confusion, chute...)</li>
      <li><input type="checkbox"> Plan de surveillance adapt√© mis en ≈ìuvre</li>
      <li><input type="checkbox"> Information du patient assur√©e et trac√©e</li>
    </ul>
    <textarea name="triageComment" placeholder="Commentaires ou anomalies lors du triage..." style="width:100%; height:60px;"></textarea>
    <div class="alert" style="margin-top:10px; padding:5px; border-radius:5px; font-weight:bold;"></div>
</fieldset>
<fieldset>
    <legend>Prise en charge de la douleur</legend>
    <ul>
      <li><input type="checkbox"> √âvaluation initiale de la douleur (EVA, EN, h√©t√©ro-√©valuation)</li>
      <li><input type="checkbox"> Tra√ßabilit√© de l‚Äôintensit√© de la douleur dans le dossier</li>
      <li><input type="checkbox"> Prescription antalgique adapt√©e au niveau de douleur</li>
      <li><input type="checkbox"> Administration du traitement antalgique r√©alis√©e</li>
      <li><input type="checkbox"> R√©√©valuation de l‚Äôefficacit√© du traitement r√©alis√©e</li>
      <li><input type="checkbox"> R√©√©valuation trac√©e dans le dossier</li>
      <li><input type="checkbox"> Adaptation du traitement si n√©cessaire</li>
    </ul>
    <textarea name="douleurComment" placeholder="Commentaires ou anomalies de PEC de la douleur..." style="width:100%; height:60px;"></textarea>
    <div class="alert" style="margin-top:10px; padding:5px; border-radius:5px; font-weight:bold;"></div>
</fieldset>
<fieldset>
    <legend>Prescriptions initiales et soins imm√©diats</legend>
    <ul>
      <li><input type="checkbox"> Prescription m√©dicale initiale document√©e</li>
      <li><input type="checkbox"> Administration des soins r√©alis√©e selon prescription</li>
      <li><input type="checkbox"> Surveillance infirmi√®re mise en place apr√®s soins</li>
      <li><input type="checkbox"> Tra√ßabilit√© des actes infirmiers dans le DPI</li>
      <li><input type="checkbox"> Ordonnances imprim√©es ou transmises</li>
      <li><input type="checkbox"> V√©rification de la bonne compr√©hension par le patient</li>
    </ul>
    <textarea name="prescriptionComment" placeholder="Commentaires ou anomalies relatives aux prescriptions ou soins..." style="width:100%; height:60px;"></textarea>
    <div class="alert" style="margin-top:10px; padding:5px; border-radius:5px; font-weight:bold;"></div>
</fieldset>

      <li><input type="checkbox"> üîπ Information claire du patient sur les d√©cisions m√©dicales</li>
      <li><input type="checkbox"> üîπ Consentement √©clair√© recueilli et trac√© si requis</li>
      <li><input type="checkbox"> üîπ Examen clinique complet effectu√©</li>
      <li><input type="checkbox"> üîπ Hypoth√®ses diagnostiques pos√©es</li>
      <li><input type="checkbox"> üîπ Examens compl√©mentaires prescrits et trac√©s</li>
      <li><input type="checkbox"> üîπ Interpr√©tation des r√©sultats int√©gr√©e au dossier</li>
      <li><input type="checkbox"> üîπ D√©cision m√©dicale argument√©e (PEC, hospitalisation, retour domicile...)</li>
      <li><input type="checkbox"> üîπ Information du patient sur la strat√©gie m√©dicale</li>
      <li><input type="checkbox"> üîπ Tra√ßabilit√© des √©l√©ments m√©dicaux dans le DPI</li>
    </ul>
    <textarea name="pecMedicalComment" placeholder="Commentaires ou anomalies dans la prise en charge m√©dicale..." style="width:100%; height:60px;"></textarea>
    <div class="alert" style="margin-top:10px; padding:5px; border-radius:5px; font-weight:bold;"></div>
</fieldset>
<fieldset>
    <legend>V√©rification de la compl√©tude du DPI</legend>
    <ul>
      <li><input type="checkbox"> Donn√©es administratives compl√®tes et valid√©es</li>
      <li><input type="checkbox"> Fiche d‚Äôidentitovigilance int√©gr√©e et conforme</li>
      <li><input type="checkbox"> Tra√ßabilit√© compl√®te des soins infirmiers (observations, actes, √©valuations)</li>
      <li><input type="checkbox"> Tra√ßabilit√© des actes m√©dicaux (consultation, examens, prescriptions)</li>
      <li><input type="checkbox"> R√©sultats des examens compl√©mentaires int√©gr√©s</li>
      <li><input type="checkbox"> Compte rendu m√©dical et synth√®se de sortie pr√©sents</li>
      <li><input type="checkbox"> Consentements et informations patient int√©gr√©s</li>
      <li><input type="checkbox"> Codages administratifs et m√©dicaux saisis (CIM-10, GEMSA, CCMU...)</li>
    </ul>
    <textarea name="dpiCompletenessComment" placeholder="Commentaires sur la compl√©tude du dossier dans le DPI..." style="width:100%; height:60px;"></textarea>
    <div class="alert" style="margin-top:10px; padding:5px; border-radius:5px; font-weight:bold;"></div>
</fieldset>
<!-- Ici viendront les diff√©rents fieldsets dynamiques -->

  <fieldset>
    <legend>Documents de sortie - Conformit√© r√©glementaire (Art. R.1112-2 CSP)</legend>
    <ul>
      <li><input type="checkbox"> Lettre de sortie ou compte rendu d'hospitalisation</li>
      <li><input type="checkbox"> Prescription de sortie et doubles d‚Äôordonnances</li>
      <li><input type="checkbox"> Modalit√©s de sortie document√©es (domicile, structure, etc.)</li>
      <li><input type="checkbox"> Fiche de liaison IDE compl√©t√©e</li>
      <li><input type="checkbox"> Consentement √©clair√© mentionn√© si requis</li>
      <li><input type="checkbox"> Pr√©sence de tous les documents obligatoires dans le DPI</li>
      <li><input type="checkbox"> V√©rification des correspondances entre professionnels de sant√©</li>
      <li><input type="checkbox"> Remise au patient des consignes √©crites de sortie</li>
      <li><input type="checkbox"> Remise au patient des RDV post-sortie si besoin</li>
      <li><input type="checkbox"> Arr√™t de travail prescrit si indiqu√©</li>
      <li><input type="checkbox"> Arr√™t de travail remis au patient</li>
      <li><input type="checkbox"> Codage CIM-10 saisi dans le DPI</li>
      <li><input type="checkbox"> Sortie administrative r√©alis√©e une fois le dossier complet</li>
    </ul>
    <textarea name="sortieComment" placeholder="Explication / correction / FEI si besoin..."></textarea>
  </fieldset>

  <fieldset>
    <legend>Signature du professionnel ayant r√©alis√© la v√©rification</legend>
    <label>Nom : <input type="text" name="nomSoignant" style="width: 300px;"></label><br>
    <label>Pr√©nom : <input type="text" name="prenomSoignant" style="width: 300px;"></label><br>
    <label>Fonction : <input type="text" name="fonctionSoignant" style="width: 300px;"></label><br>
    <label>Nom du m√©decin r√©f√©rent : <input type="text" name="nomMedecin" style="width: 300px;"></label><br>
    <label>Pr√©nom du m√©decin r√©f√©rent : <input type="text" name="prenomMedecin" style="width: 300px;"></label><br>
    <label>Fonction : <input type="text" name="fonctionMedecin" style="width: 300px;"></label>
    <label>Nom : <input type="text" name="nomSoignant" style="width: 300px;"></label><br>
    <label>Pr√©nom : <input type="text" name="prenomSoignant" style="width: 300px;"></label><br>
    <label>Fonction : <input type="text" name="fonctionSoignant" style="width: 300px;"></label>
  </fieldset>

  <button onclick="generatePDF()">G√©n√©rer la synth√®se PDF</button>

  <script>
    // Ajout au PDF : R√©sum√© global
    const nomSoignant = document.querySelector("input[name='nomSoignant']")?.value || "";
    const prenomSoignant = document.querySelector("input[name='prenomSoignant']")?.value || "";
    const fonctionSoignant = document.querySelector("input[name='fonctionSoignant']")?.value || "";
    const globalAlert = document.getElementById("globalAlert")?.textContent || "";
    const globalComment = document.querySelector("textarea[name='globalComment']")?.value || "";

    doc.setFontSize(12);
    doc.text("R√©sum√© de conformit√© global :", 10, y); y += 7;
    doc.setFontSize(10);
    doc.text(globalAlert, 12, y); y += 7;

    if (globalComment) {
      const lines = doc.splitTextToSize(globalComment, 180);
      lines.forEach(line => {
        doc.text(line, 12, y);
        y += 6;
      });
    }
    y += 10;

    // Signature
    const now = new Date();
    const horodatage = now.toLocaleString('fr-FR');

    doc.setFontSize(12);
    doc.text("Signature du professionnel v√©rificateur :", 10, y); y += 7;
    doc.setFontSize(10);
    doc.text(`Nom : ${nomSoignant}`, 12, y); y += 6;
    doc.text(`Pr√©nom : ${prenomSoignant}`, 12, y); y += 6;
    doc.text(`Fonction : ${fonctionSoignant}`, 12, y); y += 6;
    const nomMedecin = document.querySelector("input[name='nomMedecin']")?.value || "";
    const prenomMedecin = document.querySelector("input[name='prenomMedecin']")?.value || "";
    const fonctionMedecin = document.querySelector("input[name='fonctionMedecin']")?.value || "";
    doc.text(`M√©decin r√©f√©rent : ${prenomMedecin} ${nomMedecin}`, 12, y); y += 6;
    doc.text(`Fonction m√©decin : ${fonctionMedecin}`, 12, y); y += 6;

    // Int√©gration des √©l√©ments obligatoires de tri IOA/IDE
    doc.setFontSize(12);
    doc.text("√âl√©ments essentiels d‚Äô√©valuation IOA/IDE :", 10, y); y += 7;
    doc.setFontSize(10);
    doc.text("- Identitovigilance v√©rifi√©e", 12, y); y += 6;
    doc.text("- Ordonnances et ant√©c√©dents int√©gr√©s au dossier", 12, y); y += 6;
    doc.text("- Motif d‚Äôadmission, contexte et sympt√¥mes document√©s", 12, y); y += 10; y += 6;
    doc.text(`Horodatage : ${horodatage}`, 12, y); y += 10;
    doc.text("Signature du professionnel v√©rificateur :", 10, y); y += 7;
    doc.setFontSize(10);
    doc.text(`Nom : ${nomSoignant}`, 12, y); y += 6;
    doc.text(`Pr√©nom : ${prenomSoignant}`, 12, y); y += 6;
    doc.text(`Fonction : ${fonctionSoignant}`, 12, y); y += 10;
  </script>
<fieldset>
  <legend>R√©sum√© de conformit√© global</legend>
  <div id="globalAlert" style="margin: 10px 0; padding: 10px; border-radius: 5px; font-weight: bold; text-align: center;"></div>
  <textarea name="globalComment" placeholder="Commentaires globaux, actions correctives propos√©es..." style="width:100%; height:80px;"></textarea>
</fieldset>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    function updateGlobalSummary() {
      const checkboxes = document.querySelectorAll("input[type='checkbox']");
      const checked = document.querySelectorAll("input[type='checkbox']:checked");
      const alert = document.getElementById("globalAlert");
      const total = checkboxes.length;
      const valid = checked.length;
      const pct = Math.round((valid / total) * 100);

      if (pct === 100) {
        alert.textContent = `üü¢ Dossier complet : ${pct}%`;
        alert.style.backgroundColor = "#d4edda";
        alert.style.color = "#155724";
        alert.style.border = "1px solid #c3e6cb";
      } else if (pct >= 60) {
        alert.textContent = `üü† Dossier partiellement conforme : ${pct}%`;
        alert.style.backgroundColor = "#fff3cd";
        alert.style.color = "#856404";
        alert.style.border = "1px solid #ffeeba";
      } else {
        alert.textContent = `üî¥ Dossier incomplet : ${pct}%`;
        alert.style.backgroundColor = "#f8d7da";
        alert.style.color = "#721c24";
        alert.style.border = "1px solid #f5c6cb";
      }
    }
    document.querySelectorAll("input[type='checkbox']").forEach(cb => {
      cb.addEventListener("change", updateGlobalSummary);
    });
    updateGlobalSummary();
  });
</script>
</body>
</html>
